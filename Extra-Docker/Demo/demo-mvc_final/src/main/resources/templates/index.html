<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Home</title>
</head>
<body>
<div th:replace="fragments/layout :: layout(~{::section})">
    <section>
        <h1>Welcome</h1>

        <!-- Optional Weather: right-aligned, only if present -->
        <div th:if="${weatherPresent}" style="float:right; text-align:right; margin-top:-2rem;">
            <div><strong th:text="${weatherLabel}">Temperature</strong>: <span th:text="${weatherValue}">72 °F</span></div>
            <div style="font-size: 0.9em; color: #555;">
                <span>Unit:</span>
                <a th:classappend="${weatherUnit} == 'F' ? 'active' : ''" th:href="@{/(unit='F')}">F</a>
                |
                <a th:classappend="${weatherUnit} == 'C' ? 'active' : ''" th:href="@{/(unit='C')}">C</a>
            </div>
        </div>

        <!-- Anonymous view: system statistics -->
        <section th:if="${anonymous}">
            <h2>System statistics</h2>
            <ul>
                <li>Total users: <b th:text="${usersCount}">0</b></li>
                <li>Total todo lists: <b th:text="${listsCount}">0</b></li>
                <li>Total todos: <b th:text="${todosCount}">0</b></li>
            </ul>
            <p>
                <a href="/signup">Create an account</a> or <a href="/login">log in</a> to start managing your todos.
            </p>
        </section>

        <!-- Authenticated view: personal lists and todos -->
        <section th:if="${!anonymous}">
            <h2>Todo Lists</h2>

            <div th:if="${#lists.isEmpty(todoLists)}">
                <p>No lists yet. <a href="/todos/lists/new">Create your first list</a>.</p>
            </div>

            <ul th:if="${!#lists.isEmpty(todoLists)}">
                <li th:each="list : ${todoLists}">
                    <h3>
                        <span th:text="${list.name}">List Name</span>
                        <small>#<span th:text="${list.id}">id</span></small>
                    </h3>

                    <div th:if="${list.todos == null || #lists.isEmpty(list.todos)}">
                        <em>No todos in this list.</em>
                    </div>
                    <ul th:if="${list.todos != null && !#lists.isEmpty(list.todos)}">
                        <li th:each="todo : ${list.todos}">
                            <span>#<span th:text="${todo.id}">id</span></span>
                            <span th:text="${todo.text}">Todo text</span>
                            <strong th:text="${todo.done} ? '✓' : '✗'">done?</strong>
                        </li>
                    </ul>
                    <hr/>
                </li>
            </ul>
        </section>

        <section th:if="${!anonymous}">
            <h2>Todos outside of any list</h2>

            <div th:if="${#lists.isEmpty(unlistedTodos)}">
                <em>No standalone todos.</em>
            </div>

            <ul th:if="${!#lists.isEmpty(unlistedTodos)}">
                <li th:each="todo : ${unlistedTodos}">
                    <span>#<span th:text="${todo.id}">id</span></span>
                    <span th:text="${todo.text}">Todo text</span>
                    <strong th:text="${todo.done} ? '✓' : '✗'">done?</strong>
                </li>
            </ul>
        </section>
    </section>
</div>
</body>
</html>